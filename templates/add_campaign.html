<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Campaign</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container my-5">
        <h1>Create New Campaign</h1>
        <form action="{{ url_for('add_campaign') }}" method="POST" id="campaign-form">
            <div class="form-group">
                <label for="name">Campaign Name</label>
                <input type="text" class="form-control" id="name" name="name" required>
            </div>

            <div class="form-group mt-4">
                <label for="leadlist-search">Search Lead Lists</label>
                <input type="text" class="form-control" id="leadlist-search" placeholder="Type to search lead lists...">
                <ul class="list-group mt-2" id="search-results" style="display: none;"></ul>
            </div>

            <h3 class="mt-4">Selected Lead Lists</h3>
            <ul class="list-group mb-3" id="selected-lead-lists">
                <!-- Selected lead lists will appear here -->
            </ul>

            <button type="submit" class="btn btn-primary">Create Campaign</button>
            <a href="{{ url_for('campaignlist') }}" class="btn btn-secondary">Cancel</a>
        </form>
    </div>

    <!-- jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        $(document).ready(function() {
            // AJAX search for lead lists
            $('#leadlist-search').on('input', function() {
                const query = $(this).val().trim();
                if (query.length > 0) {
                    $.ajax({
                        url: "{{ url_for('search_lead_lists') }}",
                        method: "GET",
                        data: { query: query },
                        success: function(data) {
                            $('#search-results').empty().show();
                            data.forEach(function(leadList) {
                                $('#search-results').append(
                                    `<li class="list-group-item lead-list-item" data-id="${leadList.id}" data-name="${leadList.name}">
                                        ${leadList.name}
                                    </li>`
                                );
                            });
                        }
                    });
                } else {
                    $('#search-results').hide();
                }
            });

            // Add selected lead list to the form
            $(document).on('click', '.lead-list-item', function() {
                const leadListId = $(this).data('id');
                const leadListName = $(this).data('name');

                // Check if already selected
                if ($('#selected-lead-lists input[value="' + leadListId + '"]').length === 0) {
                    $('#selected-lead-lists').append(
                        `<li class="list-group-item d-flex justify-content-between align-items-center">
                            ${leadListName}
                            <button type="button" class="btn btn-danger btn-sm remove-lead-list" data-id="${leadListId}">
                                Remove
                            </button>
                            <input type="hidden" name="lead_list_ids" value="${leadListId}">
                        </li>`
                    );
                }

                // Hide search results and clear search input
                $('#search-results').hide().empty();
                $('#leadlist-search').val('');
            });

            // Remove selected lead list
            $(document).on('click', '.remove-lead-list', function() {
                $(this).closest('li').remove();
            });
        });
    </script>
</body>
</html>
